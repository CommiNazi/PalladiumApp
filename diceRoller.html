<!DOCTYPE html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
  <link rel="stylesheet" href="css/roll.css"/>
  <script src="js/chance.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
  <script type='text/javascript'>
var numDice = ["d4","d6","d8","d10","d100","d12","d20","d30"];
var directionDice = ["card","cardinal"]
var genderDice = ["gender"]
var ageDice = ["any-age", "child", "teen", "adult", "senior"]
var letterDice = ["letter"]
function createButtons(assignment,type = assignment,counter = false){
  function createCounter(assignment) {
    function createArrowButton(direction, assignment){
      var link = document.createElement("a")
      link.href="#"
      $(link).addClass("arrow "+direction);
      $(link).attr("assignment", assignment);
      return link;
    }
    var up = createArrowButton("up",assignment);
    var down = createArrowButton("down",assignment);
    var diceBottom = document.createElement("DIV");
    diceBottom.className = "diceBottom";
    $(diceBottom).append(down);
    $(diceBottom).append(up);
    return diceBottom;
  }
  var container = document.createElement("DIV")
  $(container).addClass("dice "+assignment+" "+type);
  var mainButton = document.createElement("BUTTON");
  mainButton.className = "diceTop";
  $(mainButton).append("<img class='deece' src='images/"+assignment+".png' assignment="+assignment+" />")
  $(container).append(mainButton);
  if(counter===true) {
    var diceBottom = createCounter(assignment)
    $(container).append(diceBottom);
  }
  $(container).on("click", function(target) {
    var assignment = $(target.currentTarget).attr("class").split(' ')[1];
    var amount = $("#"+assignment).text()>1?$("#"+assignment).text():1;
    var type = $(target.currentTarget).attr("class").split(' ')[2];
    writeDice(amount,assignment,type);
  });
  return container;
}
function randomNamePart(obj) {
  var id
    var gen = $("#namePartGender :radio:checked").val();
    var options = { gender: gen };
    if(!gen||gen=="all") var options = "";

  switch(obj.id){
    case "suffix": id=chance.suffix(options); break;
    case "prefix": id=chance.prefix(options); break;
    case "first": id=chance.first(options); break;
    case "last": id=chance.last(options); break;
  }
  $("#namePartResult").empty().append(document.createTextNode(id));
}
function randomLetter(amount, letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"){ //allowed grains: any string of characters.
  var letter = "";
  for(var x=0;x<amount;x++){
    letter += chance.character({pool:letters})+" ";
  }
  return letter;
}
function randomDirection(grain){ //allowed grains: 4,8,card,cardinal,basic,extended
  var basic = ["N","E","W","S"];
  var extended = ["N","E","W","S","NE","NW","SW","SE"];
  var result
  if(grain=="card"||grain==4||grain=="basic"){
    result = chance.pickone(basic)
  } else if(grain=="cardinal"||grain==8||grain=="extended") {
    result = chance.pickone(extended)
  } else {
    result = "";
    console.error("randomDirection Failed. Grain invalid: "+grain); return;
  }
  return result;
}
function randomAge(grain){ //allowed grains: any, child, teen, adult, senior
  var result;
  if(!grain||grain == "any-age") { result = chance.age();} else {result = chance.age({type: grain});}
  return result;
}
function rollNumberDice(amount,type){ //allowed grains: #d# where first # is amount of dice, and second # is type of dice. E.g. 2d10
  var result = String(chance.rpg(amount+type));
  var sum = result.split(",").reduce(function(pv, cv) { return parseInt(pv) + parseInt(cv); }, 0);
  if(result != sum) result = result + " = " + sum;
  return result;
}
function writeDice(amount,assignment,type) {
  var result;
  switch (type) {
    case "number":    result = rollNumberDice(amount,assignment); break;
    case "direction": result = randomDirection(assignment); break;
    case "age" :      result = randomAge(assignment); break;
    case "sex":       result = String(chance.gender()); break;
    case "alpha":     result = randomLetter(amount); break;
    default:          result = "ERROR! writeDice args: "+amount+" "+assignment+" "+type; break;
  }
  $("#result").empty().append(document.createTextNode(result))
  resize();
}
function resize(){
  var result = $("#result");
  result.height(2);
  result.css("resize:none;")
    var contentHeight = result[0].scrollHeight;
    if (contentHeight<80) contentHeight = 80;
    if (contentHeight > result.height()) result.height(contentHeight);
}
function initialize(){
  $(".diceTop").button({text: false});
  $(".namePart").button().click(function(e){
    randomNamePart(this)
  });
  $("#mix,#clear").button().click(function( event ) {
    event.preventDefault();
    if(this.className.split(" ")[0] == "diceTop") return;
    if(this.name=="clear") {
      $(".spinner").each(function(index) {
        this.value = 0;
      });
      return;
    }
    var collection = new Array();
    $(".spinner").each(function(index) {
      if(!this.value||this.value == 0) return true;
      collection.push(chance.rpg(this.value+this.name));
    });
    var displayResults = ""
    var finalResult = 0;
    $.each(collection, function(index) {
      var sum = this.reduce(function(pv, cv) {return parseInt(pv) + parseInt(cv); }, 0);
      collection[index] = collection[index]!=sum?collection[index] + " = " + sum:collection[index];
      displayResults += collection[index] + "\n";
      finalResult += sum;
    });
    displayResults = displayResults + "Final Total: " + finalResult;
    $("#diceResult").empty().append(displayResults);
    resize();
  });
  $(".up").button({
    text: false,
    icons: {primary: "ui-icon-seek-next"}
  }).on("click",function(e){
    var target = e.currentTarget.attributes.assignment.textContent
    var curNum = parseInt(parseInt($("#"+target).text()))
    if(!$("#"+target).text()) {
      $("img[assignment="+target+"]").after('<span id="'+target+'" class="overlay" style="">1</span>'); //img assignment = assignment
      $(this).parentsUntil(".dice").children(".down").button("option", "disabled", false)
    } else if (curNum < 9) {
      $("#"+target).text(curNum+1)
      $(this).parentsUntil(".dice").children(".down").button("option", "disabled", false)
    } else {
      $("#"+target).text(curNum+1)
      $(this).button("option", "disabled", true);
    }
  });
  $(".down").button({
    text: false,
    disabled: true,
    icons: {primary: "ui-icon-seek-prev"}
  }).on("click",function(e){
    var target = e.currentTarget.attributes.assignment.textContent
    var curNum = parseInt(parseInt($("#"+target).text()))
    if (curNum >1) {
      $("#"+target).text(curNum-1)
      $(this).parentsUntil(".dice").children(".up").button("option", "disabled", false)
    } else if(curNum > 0){
      $("#"+target).text(curNum-1)
      $(this).button("option", "disabled", true);
      $("#"+target).remove();
    }
  });
  $("#standard").buttonset();
  $(".incl").button({icons: { primary: "ui-icon-check" }}).click(function() {
        var options;
        if ( $( this ).next().attr('aria-pressed') == "true" ) {
          options = {
            icons: { primary: "ui-icon-check" }
          };
        } else {
          options = {
            icons: {primary: "ui-icon-circle-check"}
          };
        }
        $( this ).button( "option", options );
      });
}
$(document).ready(function(){
  numDice.forEach(function(item){
    var widget = createButtons(item,"number",true);
    $("#number").append(widget)
  });
  directionDice.forEach(function(item){
    var widget = createButtons(item,"direction");
    $("#direction").append(widget);
  });
  ageDice.forEach(function(item){
    var widget = createButtons(item,"age");
    $("#age").append(widget);
  });
  (function(){var widget = createButtons("gender","sex"); $("#gender").append(widget);})();
  (function(){var widget = createButtons("letter","alpha",true); $("#alpha").append(widget);})();
  initialize();
});
  </script>
  <style>



  </style>
</head>
<body>
<div id="result" class="result"></div>
<div id="number" class="section"></div>
<hr size="3" style="clear:both;">
<div class=section>
  <div id="direction" class="inner-section"></div>
  <hr width="3" size="55" style="float: left; margin: 3px;">
  <div id="age" class="inner-section"></div>
  <hr width="3" size="55" style="float: left; margin: 3px;">
  <div id="gender" class="inner-section"></div>
  <div id="alpha" class="inner-section"></div>
</div>
<hr size="3" style="clear:both;">

<div id="person" class="section">
  <div id="directions">
  </div>
  <div id="names">
  <div id="toolbar">

    <span id="namePartGender">
      <input type="radio" id="namePartEither" name="npg" value="all"  checked="checked"><label for="namePartEither">Either Gender</label>
      <input type="radio" id="namePartMale" name="npg" value="male"><label for="namePartMale">Male Name</label>
      <input type="radio" id="namePartFemale" name="npg" value="female"><label for="namePartFemale">Female Name</label>
    </span>
    <span id="nameParts">
    <button id="prefix" class="namePart">Prefix</button>
    <button id="first" class="namePart">First Name</button>
    <button id="last" class="namePart">Last Name</button>
    <button id="suffix" class="namePart">Suffix</button>
    <textarea id="namePartResult"></textarea>
  </span>
  <button id="full">Full Name</button>
  <span id="nameGender">
    <input type="radio" id="nameEither" name="ng" value="all" checked="checked"><label for="nameEither">Either Gender</label>
    <input type="radio" id="nameMale" name="ng" value="male"><label for="nameMale">Male Name</label>
    <input type="radio" id="nameFemale" name="ng" value="female"><label for="nameFemale">Female Name</label>
  </span>
  <br>
  <input type="checkbox" id="incSuffix" class="incl ui-icon-circle-check"><label for="incSuffix">Include Suffix?</label>
  <input type="checkbox" id="incPrefix" class="incl ui-icon-circle-check"><label for="incPrefix">Include Prefix?</label>
  <input type="checkbox" id="incMiddle" class="incl ui-icon-circle-check"><label for="incMiddle">Include Middle Name?</label>
</div>

  </div>
</div>
</body>
</html>
